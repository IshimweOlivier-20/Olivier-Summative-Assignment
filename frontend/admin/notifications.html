<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Create Notification - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gray-50">
  <div class="max-w-3xl mx-auto p-4">
    <h1 class="text-2xl font-semibold">Create Notification</h1>
    <div id="editor" class="mt-4 bg-white p-4 rounded shadow"></div>
  </div>

  <script src="../js/config.js"></script>
  <script src="../js/toast.js"></script>
  <script src="../js/api.js"></script>
  <script src="../js/auth.js"></script>
  <script>
    $(function(){
      if(!isAuthenticated() || !isAdmin()){ showError('Admin access required'); window.location.href='../login.html'; return; }

      const formHtml = `
        <form id="notif-form" class="space-y-3">
          <div><label class="block text-sm">Title</label><input name="title" class="mt-1 w-full border rounded px-3 py-2" required /></div>
          <div><label class="block text-sm">Message</label><textarea name="message" class="mt-1 w-full border rounded px-3 py-2" required></textarea></div>
          <div><label class="block text-sm">Type</label><select name="type" class="mt-1 border rounded px-3 py-2"><option value="system">System</option><option value="event">Event</option><option value="promo">Promo</option></select></div>
          <div><label class="block text-sm">Recipient (optional user id)</label><input name="recipient_id" class="mt-1 w-full border rounded px-3 py-2" /></div>
          <div><button class="px-3 py-1 bg-indigo-600 text-white rounded">Send Notification</button></div>
        </form>
      `;

      $('#editor').html(formHtml);

      $('#notif-form').on('submit', function(e){
        e.preventDefault();
        const data = {
          title: $('#notif-form [name=title]').val(),
          message: $('#notif-form [name=message]').val(),
          type: $('#notif-form [name=type]').val(),
          recipient_id: $('#notif-form [name=recipient_id]').val() || null
        };
        apiPost('/api/notifications', JSON.stringify(data), 'application/json').then(()=>{ showSuccess('Notification created'); window.location.href='../admin/dashboard.html'; }).catch(err=> showError(err.message || 'Failed'));
      });
    });
  </script>
</body>
</html>
