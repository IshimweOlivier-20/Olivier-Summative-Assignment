<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>My Profile - Olivier</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gray-50">
  <div class="max-w-2xl mx-auto p-4">
    <h1 class="text-2xl font-semibold">My Profile</h1>
    <div id="profile-form" class="mt-4 bg-white p-4 rounded shadow"></div>
  </div>

  <script src="js/config.js"></script>
  <script src="js/toast.js"></script>
  <script src="js/api.js"></script>
  <script src="js/auth.js"></script>
  <script>
    $(function(){
      if(!isAuthenticated()){ window.location.href = 'login.html'; return; }
      apiGet('/api/users/profile/me').then(user=>{
        const html = `
          <form id="form-profile" class="space-y-3">
            <div>
              <label class="block text-sm">Full name</label>
              <input name="full_name" value="${user.full_name||''}" class="mt-1 w-full border rounded px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm">Email</label>
              <input name="email" value="${user.email||''}" class="mt-1 w-full border rounded px-3 py-2" />
            </div>
            <div>
              <button class="px-3 py-1 bg-indigo-600 text-white rounded">Save</button>
            </div>
          </form>
        `;
        $('#profile-form').html(html);
        $('#form-profile').on('submit', function(e){
          e.preventDefault();
          const body = {
            full_name: $(this).find('[name=full_name]').val(),
            email: $(this).find('[name=email]').val()
          };
          apiPost('/api/users/profile/me', JSON.stringify(body), 'application/json')
            .then(()=>{ showSuccess('Profile updated'); })
            .catch(err=> showError(err.message || 'Update failed'));
        });
      }).catch(err=>{ showError('Failed to load profile'); window.location.href='login.html'; });
    });
  </script>
</body>
</html>
